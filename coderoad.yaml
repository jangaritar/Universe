version: '0.1.2'
config:
  testRunner:
    command: ./node_modules/.bin/mocha
    args:
      filter: --grep
      tap: --reporter=mocha-tap-reporter
    setup:
      commands:
        - npm install
        - cd /etc/postgresql/12/main && sudo sed -i "s/peer/trust/" pg_hba.conf && sudo sed -i "s/md5/trust/" pg_hba.conf
        - sudo service postgresql start
        - sudo -u postgres psql -c "CREATE USER freecodecamp WITH CREATEDB;"
        - sudo -u postgres psql -c "ALTER ROLE postgres WITH PASSWORD 'password';"
        - cd /etc/postgresql/12/main && sudo chmod 777 postgresql.conf && echo "log_statement = 'all'" >> postgresql.conf && echo "log_checkpoints = on" >> postgresql.conf && echo "log_min_error_statement = INFO" >> postgresql.conf && echo "log_min_messages = INFO" >> postgresql.conf && echo "logging_collector = on" >> postgresql.conf && echo "log_directory = '/home/strove/project/.freeCodeCamp/test'" >> postgresql.conf && echo "log_filename = 'pg.log'" >> postgresql.conf && echo "log_connections = on" >> postgresql.conf && echo "log_line_prefix = '%u '" >> postgresql.conf
    directory: .freeCodeCamp
  repo:
    uri: https://github.com/moT01/celestial-bodies-database
    branch: v0.1.2
  dependencies:
    - name: node
      version: '>=10'
levels:
  - id: '1'
    steps:
      - id: '1.1'
        setup:
          watchers:
            - ./.freeCodeCamp/test/pg.log
